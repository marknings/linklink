(function() {
    $.getJSON('getWarningSession',{},function(data){
        if(!data.status){
            $.modal.open({
                template: "comfirmDetail.html",
                controller:function(data){
                    var bindData={comfirm:function(){
                        $.post('setWarningSession',{},function(data){                           
                            $.modal.close();
                        });
                    }};
                    $.bindData.compileAll($('#footer'),bindData);                                
                }
            });
        }
    });
    
    var pageNo=1;
    var pageNumber;
    var pageSize=5;

    var infos={};

    infos.prev=function(){
        var index=pageNo>1?pageNo-1:pageNo;
        infos.getDataByPageIndex(index);
    };
    infos.next=function(){
        var index=pageNo<pageNumber?pageNo+1:pageNo;
        infos.getDataByPageIndex(index);
    };
    infos.goto=function(index){
        infos.getDataByPageIndex(index);
    };

    infos.openDetail=function(item){
        try{
            item['infoFileJSON']=JSON.parse(item.infoFile); 
        }catch(e){
            item['infoFileJSON']=new Array();
        }

        item['downLoadFile']=function(item){
            console.log(item);
            location.href='/downLoadFile?fileId='+item.fileId;
        }
             
        $.bindData.compileAll($('#infoDetail'),item);
        $('#infoBody').html(item.infoBody);
    };
    infos.getDataByPageIndex=function(index){
        pageNo=index;
        var loadInstance=$.modal.loading({message:"加载数据中..."});
	    $.getJSON('getInfos',{pageNo:pageNo,pageSize:pageSize},function(data){
	        infos.data=data.data;	        
	        infos.IndexArray=[];
	        pageNumber=Math.ceil(data.totalCount/data.pageSize);
	        for(var i=0;i<pageNumber;i++){
	            infos.IndexArray.push({index:i+1});
	        }
	        $.bindData.compileAll($('#infosList'),infos);
	        $('.context_left_pagesize_number').removeClass('context_left_pagesize_current').eq(index-1).addClass('context_left_pagesize_current');
	        if(infos.data.length>0){
	        	infos.openDetail(infos.data[0]);
	        }
            loadInstance.open.then(function(){                
                loadInstance.close();
            });
	    });
    };
    infos.getDataByPageIndex(1);

    /*$.getJSON('getInfos',{pageNo:1,pageSize:20},function(data){
        infos.data=data.data;
        
         infos.IndexArray=[];
            pageNumber=Math.ceil(data.totalCount/data.pageSize);
            for(var i=0;i<pageNumber;i++){
                infos.IndexArray.push({index:i+1});
            }
            $.bindData.compileAll($('#infosList'),infos);
            $('.context_left_pagesize_number').removeClass('context_left_pagesize_current').eq(index-1).addClass('context_left_pagesize_current');
        if(infos.data.length>0){
        	infos.openDetail(infos.data[0]);
        }
    });*/

})()