(function() {
    var pageNo=1;
    var pageNumber;
    var pageSize=7
    var productsValue={};
    productsValue.openHistory=function(item){
        var instance=$.modal.open({template:"productValueDetail.html",
            controller:function(data){
                 var loadInstance=$.modal.loading({message:"加载数据中..."});
                $.getJSON('getHistoryValuesById',{productId:data.productId,pageNo:1,pageSize:50},function(result){
                    var historyData={productName:data.productName};
                    historyData.historyData=result.data;
                    $.bindData.compileAll($('#modalProductValue'),historyData);
                    loadInstance.open.then(function(){                
                            loadInstance.close();
                        });
                })                
            },
            data:item,
            canMove:true
        });
    };
    productsValue.prev=function(){
        var index=pageNo>1?pageNo-1:pageNo;
        productsValue.getDataByPageIndex(index);
    };
    productsValue.next=function(){
        var index=pageNo<pageNumber?pageNo+1:pageNo;
        productsValue.getDataByPageIndex(index);
    };
    productsValue.goto=function(index){
        productsValue.getDataByPageIndex(index);
    };
    productsValue.getDataByPageIndex=function(index){
        pageNo=index;
        var loadInstance=$.modal.loading({message:"加载数据中..."});
        $.getJSON('getProductValues',{pageNo:pageNo,pageSize:pageSize},function(data){
            productsValue.data=data.data;
            productsValue.IndexArray=[];
            pageNumber=Math.ceil(data.totalCount/data.pageSize);
            for(var i=0;i<pageNumber;i++){
                productsValue.IndexArray.push({index:i+1});
            }
            $.bindData.compileAll($('#productValueTable'),productsValue);
            $('.context_left_pagesize_number').removeClass('context_left_pagesize_current').eq(index-1).addClass('context_left_pagesize_current');
            loadInstance.open.then(function(){                
                loadInstance.close();
            });
        });
    };
    productsValue.getDataByPageIndex(1);
})()